<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      body { margin: 0; overflow: hidden; font-family: sans-serif; }
      
      /* Landing Page Overlay */
      #overlay {
        position: absolute; z-index: 1000; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        color: white; text-align: center;
      }

      #playButton {
        padding: 15px 40px; font-size: 20px; cursor: pointer;
        background-color: #007bff; color: white; border: none; border-radius: 5px;
        margin-top: 20px; transition: 0.3s;
      }

      #playButton:hover { background-color: #0056b3; }

      /* Scanning indicator (optional) */
      #scanning-overlay {
        position: absolute; z-index: 999; width: 100%; height: 100%;
        display: none; pointer-events: none;
        border: 5px solid rgba(255, 255, 255, 0.5); box-sizing: border-box;
      }
    </style>
  </head>

  <body>
    <div id="overlay">
      <h1>AR Video Experience</h1>
      <p>Scan the image to see the video magic.</p>
      <button id="playButton">START EXPERIENCE</button>
    </div>

    <div id="scanning-overlay"></div>

    <a-scene 
      mindar-image="imageTargetSrc: https://mahesh2710.github.io/ARData/target/blinkit.mind; autoStart: false; uiScanning: #scanning-overlay;" 
      color-space="sRGB" 
      renderer="colorManagement: true, physicallyCorrectLights" 
      vr-mode-ui="enabled: false" 
      device-orientation-permission-ui="enabled: false">
      
      <a-assets>
        <video id="arVideo" src="https://mahesh2710.github.io/ARData/video/Blinkit.mp4" preload="auto" loop="true" crossorigin="anonymous" playsinline></video>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: 10000; objects: .clickable"></a-camera>

      <a-entity id="target" mindar-image-target="targetIndex: 0">
        <a-video src="#arVideo" width="1" height="0.6" position="0 0 0" rotation="0 0 0"></a-video>
      </a-entity>
    </a-scene>

    <script>
      const playButton = document.getElementById('playButton');
      const overlay = document.getElementById('overlay');
      const video = document.getElementById('arVideo');
      const sceneEl = document.querySelector('a-scene');

      playButton.addEventListener('click', () => {
        // 1. Hide Overlay
        overlay.style.display = 'none';

        // 2. Start MindAR engine and camera
        const { system } = sceneEl;
        system.start(); 

        // 3. Pre-play video (muted) to bypass mobile restrictions
        // It will only be visible when the image is tracked
        video.play().catch(err => console.log("Video play blocked until tracking", err));
      });

      // Logic to pause/play video based on tracking
      const targetEl = document.querySelector('#target');
      targetEl.addEventListener("targetFound", event => {
        console.log("Target found!");
        video.play();
      });

      targetEl.addEventListener("targetLost", event => {
        console.log("Target lost");
        video.pause();
      });
    </script>
  </body>
</html>
