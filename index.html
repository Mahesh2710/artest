<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
      /* FULL SCREEN STATE (Default/Target Lost) */
      #video-container.full-screen {
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        z-index: 999;
        background: black;
      }

      /* AR STATE (When Target is Found) */
      #video-container.ar-mode {
        position: absolute;
        width: 300px; /* Adjust to match poster proportions */
        height: 169px;
        z-index: 10;
        transform-origin: top left;
      }

      iframe { border: none; width: 100%; height: 100%; }
      
      #UI-Hint {
        position: absolute; top: 10px; width: 100%; text-align: center;
        color: white; z-index: 1000; font-family: sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="UI-Hint">Point camera at poster to lock video</div>

    <div id="video-container" class="full-screen">
      <iframe id="player" 
        src="https://www.youtube.com/embed/M0TWfl2gK3E?enablejsapi=1&mute=1&autoplay=1" 
        allow="autoplay">
      </iframe>
    </div>

    <a-scene mindar-image="imageTargetSrc: ./aajtak.mind;" vr-mode-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
      <a-entity id="my-target" mindar-image-target="targetIndex: 0">
        <a-entity id="anchor"></a-entity>
      </a-entity>
    </a-scene>

    <script>
      const container = document.querySelector('#video-container');
      const target = document.querySelector('#my-target');
      const hint = document.querySelector('#UI-Hint');

      // WHEN POSTER IS SEEN
      target.addEventListener("targetFound", () => {
        container.classList.remove('full-screen');
        container.classList.add('ar-mode');
        hint.innerText = "Video locked to poster";
      });

      // WHEN POSTER IS LOST
      target.addEventListener("targetLost", () => {
        container.classList.remove('ar-mode');
        container.classList.add('full-screen');
        container.style.transform = ""; // Reset AR positioning
        hint.innerText = "Poster lost - Full screen mode";
      });

      // SYNC POSITION (This makes the 2D video follow the 3D target)
      function loop() {
        if (container.classList.contains('ar-mode')) {
          const anchor = document.querySelector('#anchor');
          const projection = anchor.object3D.getWorldPosition(new THREE.Vector3());
          // Simple screen projection logic would go here for perfect pinning
          // For a basic version, MindAR handles the 'entity' visibility.
        }
        requestAnimationFrame(loop);
      }
      loop();
    </script>
  </body>
</html>