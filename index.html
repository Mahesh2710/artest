<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WebAR Video Experience</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
  <a-scene mindar-image="imageTargetSrc: https://mahesh2710.github.io/ARData/target/blinkit.mind; autoStart: false; uiLoading: no; uiError: no; uiScanning: no;"
           embedded color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights"
           vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">

    <a-assets>
      <!-- Preload your video (don't autoplay yet) -->
      <video id="ar-video" src="https://mahesh2710.github.io/ARData/video/Blinkit.mp4" loop="true" preload="auto" playsinline webkit-playsinline muted></video>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;"></a-camera>

    <!-- The entity for the image target (index 0 for single target) -->
    <a-entity id="target-entity" mindar-image-target="targetIndex: 0">
      <!-- Overlay the video on the target (adjust width/height to match your video aspect ratio) -->
      <a-video src="#ar-video" position="0 0 0.1" width="1" height="1.5" rotation="0 0 0"></a-video>
    </a-entity>
  </a-scene>

  <script>
    // Get references
    const scene = document.querySelector('a-scene');
    const targetEntity = document.querySelector('#target-entity');
    const video = document.querySelector('#ar-video');

    // Start AR after user permission (autoStart: false prevents immediate camera prompt)
    scene.addEventListener('arReady', () => {
      console.log('AR ready');
    });

    // Handle target found: Play video
    targetEntity.addEventListener('targetFound', () => {
      console.log('Target found - playing video');
      video.muted = false; // Unmute if needed
      video.play();
    });

    // Handle target lost: Switch video to full screen (continue playing)
    targetEntity.addEventListener('targetLost', () => {
      console.log('Target lost - entering full screen');
      enterFullScreen(video);
    });

    // Cross-browser full screen function (handles Chrome and Safari/iOS)
    function enterFullScreen(element) {
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.webkitRequestFullscreen) { // Chrome/Safari Android
        element.webkitRequestFullscreen();
      } else if (element.webkitEnterFullScreen) { // iOS Safari (for video elements)
        element.webkitEnterFullScreen();
      } else if (element.mozRequestFullScreen) { // Firefox (fallback)
        element.mozRequestFullScreen();
      } else if (element.msRequestFullscreen) { // IE/Edge (fallback)
        element.msRequestFullscreen();
      }
    }

    // Prompt camera access and start AR on page load or button click
    window.addEventListener('load', () => {
      scene.components['mindar-image'].start();
    });
  </script>
</body>
</html>
