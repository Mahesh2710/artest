<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      body { margin: 0; overflow: hidden; font-family: sans-serif; }
      
      /* Landing Page Overlay */
      #overlay {
        position: absolute; z-index: 1000; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        color: white; text-align: center;
      }

      #playButton {
        padding: 15px 40px; font-size: 20px; cursor: pointer;
        background-color: #00c853; color: white; border: none; border-radius: 50px;
        margin-top: 20px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,200,83,0.4);
      }

      /* MindAR built-in scanning UI custom styling */
      .mindar-ui-scanning { display: none; }
    </style>
  </head>

  <body>
    <div id="overlay">
      <h1>Blinkit AR Experience</h1>
      <p>Click start and point your camera <br/> at the Blinkit logo/image.</p>
      <button id="playButton">START EXPERIENCE</button>
    </div>

    <a-scene 
      mindar-image="imageTargetSrc: https://mahesh2710.github.io/ARData/target/blinkit.mind; autoStart: false;" 
      color-space="sRGB" 
      renderer="colorManagement: true, physicallyCorrectLights" 
      vr-mode-ui="enabled: false" 
      device-orientation-permission-ui="enabled: false">
      
      <a-assets>
        <video id="arVideo" 
               src="https://mahesh2710.github.io/ARData/video/Blinkit.mp4" 
               preload="auto" 
               loop="true" 
               crossorigin="anonymous" 
               playsinline 
               webkit-playsinline>
        </video>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity id="target" mindar-image-target="targetIndex: 0">
        <a-video src="#arVideo" width="1" height="0.56" position="0 0 0"></a-video>
      </a-entity>
    </a-scene>

    <script>
      const playButton = document.getElementById('playButton');
      const overlay = document.getElementById('overlay');
      const video = document.getElementById('arVideo');
      const sceneEl = document.querySelector('a-scene');

      playButton.addEventListener('click', () => {
        overlay.style.display = 'none';

        // Fix: Use the correct system name to start the camera
        const arSystem = sceneEl.systems["mindar-image-system"];
        arSystem.start(); 

        // Warm up the video: Play and immediately pause 
        // This satisfies the browser's "user gesture" requirement
        video.play();
        video.pause();
        console.log("AR System Started & Video Primed");
      });

      const targetEl = document.querySelector('#target');

      targetEl.addEventListener("targetFound", () => {
        console.log("Target detected!");
        video.play();
      });

      targetEl.addEventListener("targetLost", () => {
        console.log("Target lost.");
        video.pause();
      });
    </script>
  </body>
</html>
